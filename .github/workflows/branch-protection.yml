name: Branch Protection Rules

on:
  pull_request_target:
    types:
      - opened
      - reopened
      - synchronize
      - edited

jobs:
  protect-branches:
    runs-on: ubuntu-latest
    steps:
      - name: Validate PR source branches
        run: |
          SOURCE="${{ github.head_ref }}"
          TARGET="${{ github.base_ref }}"

          echo "Source: $SOURCE"
          echo "Target: $TARGET"

          # 1. Iedereen mag naar dev â†’ geen restricties
          if [ "$TARGET" = "dev" ]; then
            echo "PR to dev allowed."
            exit 0
          fi

          # 2. test mag alleen PR's ontvangen van dev
          if [ "$TARGET" = "test" ] && [ "$SOURCE" != "dev" ]; then
            echo "ERROR: Only 'dev' is allowed to make pull requests to 'test'."
            exit 1
          fi

          # 3. main mag alleen PR's ontvangen van test
          if [ "$TARGET" = "main" ] && [ "$SOURCE" != "test" ]; then
            echo "ERROR: Only 'test' is allowed to make pull requests to 'main'."
            exit 1
          fi

          echo "PR allowed."
